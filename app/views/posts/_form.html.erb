<div class="flex justify-center md:text-xl">
  <%= form_with model: post, local: true do |f| %>
    <%= render 'shared/error_messages', object: f.object %>
    <div class="mb-5">
      <%= f.label :date, class:"font-bold text-2xl" %><br>
      <%= f.date_field :date, class: 'p-5' %>
    </div>
    <div class="mb-5">
      <%= f.label :body, class:"font-bold text-2xl" %><br>
      <%= f.text_area :body, size: "40x5" %>
    </div>
    <div class="mb-5">
      <%= f.label :image, class:"font-bold text-2xl" %><br>
      <%= f.file_field :image, onchange: 'previewImage(post_preview)', accept: 'image/*', class: 'file-input file-input-accent w-full max-w-xs mb-3' %>
      <%= f.hidden_field :image_cache %>
    </div>
    <div class='mt-3 mb-3 flex justify-center'>
      <% if post.image? %>
        <%= image_tag post.image.url, id: 'post_preview', size: '100x100' %>
      <% end %>
    </div>
    <%= f.submit t('defaults.create'), class: 'btn btn-accent text-xl mb-5' %>
  <% end %>
</div>

<script>
function previewImage() {
  const target = this.event.target;
  const file = target.files[0];
  const reader  = new FileReader();
  reader.onloadend = function () {
      const preview = document.querySelector("#post_preview")
      if(preview) {
          preview.src = reader.result;
      }
  }
  if (file) {
      reader.readAsDataURL(file);
  }
}
</script>