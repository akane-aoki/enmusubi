<% set_meta_tags title: t('.title') %>
<div class="p-4 m-5 text-center">
  <div class="text-4xl md:flex justify-center">
    <div class="font-bold border-b-2 border-syuiro md:w-2/3 xl:w-1/3"><%= t('.title') %></div>
  </div>
</div>
<div class="p-2 m-2 md:text-2xl flex justify-center text-center">
  <div class="">
    <div class="">
      <%= form_with model: @user, url: profile_path, local: true do |f| %>
        <%= render 'shared/error_messages', object: f.object %>
        <div class="form-group mb-3">
          <div><%= f.label :name, class:"font-bold" %></div>
          <div><%= f.text_field :name, class: 'w-full' %></div>
        </div>
        <div class="form-group mb-3">
          <div><%= f.label :email, class:"font-bold" %></div>
          <div><%= f.email_field :email, class: 'w-full' %></div>
        </div>
        <div class="form-group mb-3">
          <div><%= f.label :address, class:"font-bold" %></div>
          <div><%= f.text_field :address, class: 'w-full' %></div>
        </div>
        <div class="form-group mb-3">
          <div><%= f.label :avatar, class:"font-bold" %></div>
          <div><%= f.file_field :avatar, onchange: 'previewImage(preview)', class: 'file-input w-full mb-3', accept: 'image/*' %></div>
          <div><%= f.hidden_field :avatar_cache %></div>
        </div>
        <div class='mt-3 mb-3 flex justify-center'>
          <% if @user.avatar.present? %>
            <%= image_tag @user.avatar.url, id: 'preview', size: '100x100', class: 'rounded-circle' %>
          <% else %>
            <%= image_tag "nekoneko.png", id: 'preview', size: '100x100', class: 'rounded-circle' %>
          <% end %>
        </div>
        <%= f.submit class: 'btn btn-accent my-3' %>
      <% end %>
    </div>
  </div>
</div>

<script>
function previewImage() {
    const target = this.event.target;
    const file = target.files[0];
    const reader  = new FileReader();
    reader.onloadend = function () {
        const preview = document.querySelector("#preview")
        if(preview) {
            preview.src = reader.result;
        }
    }
    if (file) {
        reader.readAsDataURL(file);
    }
  }
</script>